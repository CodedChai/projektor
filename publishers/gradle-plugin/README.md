# gradle-plugin

This Gradle plugin supports automatically gathering and publishing
the XML test results to the Projektor server. It listens to the 
end of the build, gathers up all the XML results generated by
`Test` tasks in the build, then sends those to the Projektor server.

## Use plugin

To apply this plugin to your project:

```
plugins {
  id "projektor.publish"
}
```

By default the plugin publishes results from all `Test` tasks in the project
when the build finishes.

The plugin also adds a `publishResults` task that lets you publish test
results from a build after it has executed (for example, if you didn't have auto-publish on)
This can be a good way to easily share a specific test failure with colleagues.

`./gradlew publishResults`

Note: If you have a multi-project build, please apply the plugin to the root project.

## Configuration

All the configuration of the plugin is inside the `projektor` block. 
To use the plugin, first set the URL of the Projektor server:

```
projektor {
  serverUrl = "https://myserver"
}
```

If you want to disable the auto-publish of results at the end of the build:

```
projektor {
  serverUrl = "https://myserver"
  autoPublish = false
}
```

Or if you want to only publish results when the build fails,
set the `autoPublishOnFailureOnly` configuration value:

```
projektor {
  serverUrl = "https://myserver"
  autoPublishOnFailureOnly = true
}
```

There is also the option to not add the `publishResults` task: 

```
projektor {
  serverUrl = "https://myserver"
  manualPublishEnabled = false
}
```

## Development

### Testing

This project has unit and integration tests as well as 
full tests of the plugin leveraging [Gradle TestKit](https://docs.gradle.org/current/userguide/test_kit.html)

To run all the tests, run `../gradlew check`

Some of the tests use [WireMock](http://wiremock.org/) to verify the sending of test results
to the server.