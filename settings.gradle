plugins {
    id "com.atkinsondev.object-store-cache" version "1.0.0"
}

include 'functional-test',
        'publishers:gradle-plugin',
        'publishers:node-script:publish-functional-test',
        'server:parsing:grouped-results-parser',
        'server:parsing:junit-results-parser',
        'server:parsing:test-results-parser',
        'server:persistence:database-schema',
        'server:persistence:object-store',
        'server:server-app',
        'server:server-api',
        'server:server-client',
        'server:test:server-example-loader',
        'server:test:test-fixtures',
        'ui'

boolean isCI = Boolean.valueOf(System.getenv("GITHUB_ACTIONS"))

buildCache {
    local {
        enabled = !isCI
    }
    remote(com.atkinsondev.cache.ObjectStoreBuildCache) {
        endpoint = 'sfo2.digitaloceanspaces.com'
        accessKey = System.getenv("CACHE_ACCESS_KEY") ?: cache_access_key
        secretKey = System.getenv("CACHE_SECRET_KEY") ?: cache_secret_key
        bucket = 'projektorcache'
        autoCreateBucket = true
        expirationInDays = 10
        push = isCI
    }
}